import{setProp as N}from"./ApiChain.js";export const map=(t,...e)=>Array.prototype.map.apply(t,e),csv=(t,...e)=>map(t,...e).join(","),collectionText=t=>map(t,e=>getNodeText(e)).join("");const c=t=>document.createElement(t);function x(t,e,o){const n=c(t);return n[e]=o,n}export function isNode(t){return!!t?.nodeType}const L=()=>"",l=t=>Array.isArray(t)||t&&typeof t.forEach=="function",u=(t,e)=>typeof t===e,f=t=>u(t,"string"),S=t=>u(t,"number"),p=t=>u(t,"function"),w=t=>t.getRootNode().host,m=t=>w(t)&&t.assignedNodes,A=(t,e)=>(t.forEach(e),t),g=t=>m(t)?t.assignedNodes().forEach(e=>e.remove()):t.innerHTML="",O={1:t=>t.assignedNodes?collectionText(t.assignedNodes())||collectionText(t.childNodes):["SCRIPT","AUDIO","STYLE","CANVAS","DATALIST","EMBED","OBJECT","PICTURE","IFRAME","METER","NOSCRIPT","SELECT","OPTGROUP","PROGRESS","TEMPLATE","VIDEO"].includes(t.nodeName)?"":t.innerText,3:t=>t.nodeValue,11:t=>collectionText(t.childNodes)};export const getNodeText=t=>(O[t.nodeType]||L)(t),setNodeText=(t,e)=>m(t)?t.assignedElements().forEach(o=>o.innerText=e):t.innerText=e,assignParent=(t,e)=>t.map(o=>e.appendChild(o)),collectionHtml=t=>map(t,e=>e.assignedElements?map(e.assignedElements(),o=>o.outerHTML).join(""):e.innerHTML).join(""),html2NodeArr=t=>{const e=c("div");e.innerHTML=t;const o=n=>{if(n.nodeType!==3)return n;const s=c("span");return s.append(n),s};return[...e.childNodes].map(n=>(n.remove(),n)).map(o)},addNodeHtml=(t,e)=>{const o=(s,r)=>r instanceof Node?r.remove()||s.append(r):html2NodeArr(r).forEach(i=>s.append(i)),n=s=>m(t)?t.assign(...t.assignedNodes(),...assignParent(A(html2NodeArr(s),r=>r.slot=t.name),t.getRootNode().host)):o(t,s);e instanceof NodeList||l(e)?[...e].forEach(n):n(e)},setNodeHtml=(t,e)=>{g(t),addNodeHtml(t,e)};class h extends Array{attr(...e){return e.length>1?((e[2]?this.$(e[2]):this).setAttribute(...e),this):this.getAttribute(...e)}prop(...e){return e.length>1?((e[2]?this.$(e[2]):this).forEach(o=>o[e[0]]=e[1]),this):this[0][e[0]]}forEach(...e){return Array.prototype.forEach.apply(this,e),this}map(...e){return map(this,...e)}push(...e){return Array.prototype.push.apply(this,e),this}querySelector(e){return new h().push(this.querySelectorAll(e)[0])}querySelectorAll(e){return this.reduce((o,n)=>o.push(...(n.shadowRoot||n).querySelectorAll(e)),new h)}$(...e){return e.length?this.querySelectorAll(...e):this}parent(e){const o=new Set,n=r=>o.has(r)?0:(o.add(r),r),s=r=>{for(;r=r.parentElement;)if(r.matches(e))return n(r)};return CssChain(this.map(e?s:r=>n(r.parentElement)).filter(r=>r))}on(...e){return this.addEventListener(...e)}append(e){return this.forEach(o=>addNodeHtml(o,e))}remove(...e){return e.length?p(e[1])?this.removeEventListener(...e):this.map(o=>o.matches(e[0])).filter(o=>o):(this.forEach(o=>o.remove()),new h)}erase(){return this.forEach(e=>g(e))}slots(...e){const o=e.length?csv(e[0].split(","),r=>['""',"''"].includes(r)||!r?"slot:not([name])":`slot[name="${r}"]`):"slot",n=this.filter(r=>r.matches&&r.matches(o)),s=this.filter(r=>!n.includes(r)&&r.querySelector).map(r=>r.shadowRoot||r).$(e.length?csv(e[0].split(","),r=>['""',"''"].includes(r)||!r?"slot:not([name])":`slot[name="${r}"]`):"slot");return e.length===2?(s.html(e[1]),this):CssChain([...n,...s])}template(e){if(e===void 0){const n=this.$("[slot]").forEach(s=>this.$(s.slot?`slot[name="${s.slot}"]`:"slot:not([name])").length||s.parentNode.insertBefore(x("slot","name",s.slot),s));n.remove(),e=c("template"),this.childNodes.forEach(s=>e.content.append(s)),this.append(n)}else f(e)&&(e=this.$(e),e.remove());const o=CssChain(e.content?e.content.childNodes:e).clone(this);return o.slots().forEach(n=>{const s=this.children.filter(r=>r.slot===n.name);s.length&&setNodeHtml(n,s)}),this.children.remove(),this.append(o),this}get innerText(){return this.txt()}set innerText(e){return this.txt(e)}txt(e,o=void 0){const n=o?this.$(o):this;return e===void 0?collectionText(n):(n.forEach(p(e)?(s,r)=>setNodeText(s,e(s,r,n)):s=>setNodeText(s,e)),this)}get outerHTML(){return this.map(e=>e.outerHTML).join("")}set outerHTML(e){return this.forEach((o,n,s)=>{const r=o.parentNode;html2NodeArr(p(e)?e(o,n,s):e).forEach(i=>r.insertBefore(s[n]=i,o)),o.remove()})}get innerHTML(){return this.html()}set innerHTML(e){return this.html(e)}html(e,o=void 0){const n=o?this.$(o):this;return e===void 0?collectionHtml(n):(n.forEach(p(e)?(s,r)=>setNodeHtml(s,e(s,r,n)):s=>setNodeHtml(s,e)),this)}assignedElements(e){return CssChain([].concat(...this.map(o=>o.assignedElements?o.assignedElements(e):[])))}assignedNodes(e){return CssChain([].concat(...this.map(o=>o.assignedNodes?o.assignedNodes(e):[])))}cloneNode(...e){return this.map(o=>o.cloneNode&&o.cloneNode(...e))}clone(e=1,o=void 0){let n=e;if(S(e)&&(n=Array.from({length:e},(r,i)=>i)),l(n)){const r=[];return this.forEach(i=>n.forEach((y,T)=>{const E=i.ownerDocument.importNode(i,!0),d=o&&o(E,y,T,n);f(d)?r.push(...html2NodeArr(d)):l(d)?r.push(...d):r.push(isNode(d)?d:E)})),CssChain(r)}const s=e;return this.map(r=>s?s.importNode(r,!0):r.cloneNode?r.cloneNode(!0):Object.assign({},r))}get firstElementChild(){return CssChain(this.map(e=>e.firstElementChild).filter(e=>e))}get firstChild(){return CssChain(this.map(e=>e.firstChild).filter(e=>e))}get childNodes(){return CssChain([].concat(...map(this,e=>[...e.childNodes||[]])))}get children(){return CssChain([].concat(...map(this,e=>[...e.children||[]])))}}const a=new Set,P=Object.getPrototypeOf({});export function applyPrototype(t,e){const o=f(t)?c(t):t;if(!a.has(o.tagName)){a.add(o.tagName);for(let n in o)n in e.prototype||N(o,n,e);for(let n;(n=Object.getPrototypeOf(o))!==P&&n!=null&&!a.has(n);){a.add(n);for(let s of Object.getOwnPropertyNames(n))s in e.prototype||N(o,s,e)}}}Object.getOwnPropertyNames(window).filter(t=>t.startsWith("HTML")&&t.endsWith("Element")&&t.length>11).map(t=>t.substring(4,t.length-7).toLowerCase()).forEach(t=>applyPrototype(c(t),h));export function CssChain(t,e=document,o=[]){const n=typeof t=="string"?e.querySelectorAll(t):l(t)?t:[t?t.shadowRoot||t:document];l(o)?o.length||(o=[...n].slice(0,256)):o=[o],o.forEach(r=>applyPrototype(r,h));const s=new h;return s.push(...n),s}export default CssChain;
//# sourceMappingURL=CssChain.js.map
