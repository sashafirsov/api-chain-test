import{setProp as f}from"./ApiChain.js";export const map=(t,...e)=>Array.prototype.map.apply(t,e),csv=(t,...e)=>map(t,...e).join(","),collectionText=t=>map(t,e=>getNodeText(e)).join("");const y=()=>"",c=t=>Array.isArray(t),u=(t,e)=>typeof t===e,E=t=>u(t,"string"),x=t=>u(t,"number"),p=t=>u(t,"function"),A=t=>t&&t.nodeType,L=t=>t.getRootNode().host,l=t=>L(t)&&t.assignedNodes,S=(t,e)=>(t.forEach(e),t),N=t=>l(t)?t.assignedNodes().forEach(e=>e.remove()):t.innerHTML="",w={1:t=>t.assignedNodes?collectionText(t.assignedNodes())||collectionText(t.childNodes):["SCRIPT","AUDIO","STYLE","CANVAS","DATALIST","EMBED","OBJECT","PICTURE","IFRAME","METER","NOSCRIPT","SELECT","OPTGROUP","PROGRESS","TEMPLATE","VIDEO"].includes(t.nodeName)?"":t.innerText,3:t=>t.nodeValue,11:t=>collectionText(t.children)};export const getNodeText=t=>(w[t.nodeType]||y)(t),setNodeText=(t,e)=>l(t)?t.assignedElements().forEach(r=>r.innerText=e):t.innerText=e,assignParent=(t,e)=>t.map(r=>e.appendChild(r)),collectionHtml=t=>map(t,e=>e.assignedElements?map(e.assignedElements(),r=>r.outerHTML).join(""):e.innerHTML).join(""),html2NodeArr=t=>{const e=document.createElement("div");e.innerHTML=t;const r=n=>{if(n.nodeType!==3)return n;const s=document.createElement("span");return s.append(n),s};return[...e.childNodes].map(n=>(n.remove(),n)).map(r)},addNodeHtml=(t,e)=>{const r=(s,o)=>o instanceof Node?o.remove()||s.append(o):html2NodeArr(o).forEach(i=>s.append(i)),n=s=>l(t)?t.assign(...t.assignedNodes(),...assignParent(S(html2NodeArr(s),o=>o.slot=t.name),t.getRootNode().host)):r(t,s);e instanceof NodeList||c(e)?[...e].forEach(n):n(e)},setNodeHtml=(t,e)=>{N(t),addNodeHtml(t,e)};class h extends Array{attr(...e){return e.length>1?((e[2]?this.$(e[2]):this).setAttribute(...e),this):this.getAttribute(...e)}prop(...e){return e.length>1?((e[2]?this.$(e[2]):this).forEach(r=>r[e[0]]=e[1]),this):this[0][e[0]]}forEach(...e){return Array.prototype.forEach.apply(this,e),this}map(...e){return map(this,...e)}push(...e){return Array.prototype.push.apply(this,e),this}querySelector(e){return new h().push(this.querySelectorAll(e)[0])}querySelectorAll(e){return this.reduce((r,n)=>r.push(...n.querySelectorAll(e)),new h)}$(...e){return e.length?this.querySelectorAll(...e):this}parent(e){const r=new Set,n=o=>r.has(o)?0:(r.add(o),o),s=o=>{for(;o=o.parentElement;)if(o.matches(e))return n(o)};return CssChain(this.map(e?s:o=>n(o.parentElement)).filter(o=>o))}on(...e){return this.addEventListener(...e)}append(e){return this.forEach(r=>addNodeHtml(r,e))}remove(...e){return e.length?p(e[1])?this.removeEventListener(...e):this.map(r=>r.matches(e[0])).filter(r=>r):(this.forEach(r=>r.remove()),new h)}clear(){return this.forEach(e=>N(e))}slot(...e){const r=this.$(e.length?csv(e[0].split(","),n=>['""',"''"].includes(n)||!n?"slot:not([name])":`slot[name="${n}"]`):"slot");return e.length===2?(r.html(e[1]),this):r}get innerText(){return this.text()}set innerText(e){return this.text(e)}text(e,r=void 0){const n=r?this.$(r):this;return e===void 0?collectionText(n):(n.forEach(p(e)?(s,o)=>setNodeText(s,e(s,o,n)):s=>setNodeText(s,e)),this)}get outerHTML(){return this.map(e=>e.outerHTML).join("")}set outerHTML(e){return this.forEach((r,n,s)=>{const o=r.parentNode;html2NodeArr(p(e)?e(r,n,s):e).forEach(i=>o.insertBefore(s[n]=i,r)),r.remove()})}get innerHTML(){return this.html()}set innerHTML(e){return this.html(e)}html(e,r=void 0){const n=r?this.$(r):this;return e===void 0?collectionHtml(n):(n.forEach(p(e)?(s,o)=>setNodeHtml(s,e(s,o,n)):s=>setNodeHtml(s,e)),this)}assignedElements(){return CssChain([].concat(...this.map(e=>e.assignedElements?e.assignedElements():[])))}assignedNodes(){return CssChain([].concat(...this.map(e=>e.assignedNodes?e.assignedNodes():[])))}cloneNode(...e){return this.map(r=>r.cloneNode&&r.cloneNode(...e))}clone(e,r=void 0){let n=e;if(x(e)&&(n=Array.from({length:e},(o,i)=>i)),c(n)){const o=[];return this.forEach(i=>n.forEach((T,g)=>{const m=i.ownerDocument.importNode(i,!0),d=r&&r(m,T,g,n);E(d)?o.push(...html2NodeArr(d)):c(d)?o.push(...d):o.push(A(d)?d:m)})),CssChain(o)}const s=e;return this.map(o=>s?s.importNode(o,!0):o.cloneNode?o.cloneNode(!0):Object.assign({},o))}get firstElementChild(){return CssChain(this.map(e=>e.firstElementChild).filter(e=>e))}get firstChild(){return CssChain(this.map(e=>e.firstChild).filter(e=>e))}get childNodes(){return CssChain([].concat(...map(this,e=>[...e.childNodes||[]])))}get children(){return CssChain([].concat(...map(this,e=>[...e.children||[]])))}}const a=new Set,O=Object.getPrototypeOf({});export function applyPrototype(t,e){const r=E(t)?document.createElement(t):t;if(!a.has(r.tagName)){a.add(r.tagName);for(let n in r)n in e.prototype||f(r,n,e);for(let n;(n=Object.getPrototypeOf(r))!==O&&n!=null&&!a.has(n);){a.add(n);for(let s of Object.getOwnPropertyNames(n))s in e.prototype||f(r,s,e)}}}Object.getOwnPropertyNames(window).filter(t=>t.startsWith("HTML")&&t.endsWith("Element")&&t.length>11).map(t=>t.substring(4,t.length-7).toLowerCase()).forEach(t=>applyPrototype(document.createElement(t),h));export function CssChain(t,e=document,r=[]){const n=typeof t=="string"?e.querySelectorAll(t):c(t)?t:[t?t.shadowRoot||t:document];c(r)?r.length||(r=[...n].slice(0,256)):r=[r],r.forEach(o=>applyPrototype(o,h));const s=new h;return s.push(...n),s}export default CssChain;
//# sourceMappingURL=CssChain.js.map
